### 服务器程序规范

- Linux服务器程序一般以后台程序形式运行，后台进程又称守护进程。它们没有控制终端，不会意外收到用户通知。守护进程的父进程通常是init进程（PID为1的进程）
- Linux服务器通常有一套日志系统，它至少能输出日志到文件。
- Linux服务器一般以某个专门的非root身份运行，如mysqld、httpd、syslogd等后台程序，分别拥有自己的运行账户mysql、apache和syslog。
- Linux服务器程序通常是可配置的，如果运行选项太多，则可用配置文件来配置。
- Linux服务器进程通常会在启动的时候生成一个PID文件并存入/var/run目录中，以记录后台进程的PID。
- Linux服务器通常需要考虑系统资源和限制，以预测自身能承受多大负荷。

### 日志

- syslogd的升级版：rsyslogd：既能接受用户进程输出的日志又能接受内核日志。
- UDP日志及监听端口（默认是514，见/etc/services文件）

![image-20210228145323101](D:\桌面\推文\Linux高性能服务器编程\日志.jpg)

### 用户信息

- 大部分服务器要以root身份启动，但是不能以root身份运行。
- 一个进程拥有两个用户ID：UID和EUID。EUID存在的目的是方便资源访问，使得运行程序的用户拥有该程序的有效用户的权限。如su程序，EGID的含义是给运行目标程序的组用户提供有效组的权限。

### 进程间关系

- 进程组：Linux下每个进程都率属于一个进程组，他们除了PID信息外，还有进程组ID。进程组ID有一个叫进程组首领，其PID和PGID一样。一个进程只能设置自己或其子进程的PGID。
- 会话：一些有关联的进程组将形成一个会话。非组首领的进程，调用该函数不仅创建新会话，而且有如下额外效果。
  - 调用进程成为会话的首领，此时该进程是新会话的唯一成员
  - 新建一个进程组，其PGID就是调用进程的PID，该调用进程成为该组首领。
  - 调用进程将甩开终端。
- 用ps命令查看进程：3个进程都是同一会话
  - ![image-20210228152308645](D:\桌面\推文\Linux高性能服务器编程\用ps查看进程关系.jpg)

### 系统资源限制

- Linux上运行的程序都会收到资源限制的影响，如物理设备限制、系统策略限制等。

### 改变工作目录和根目录

- 有些服务器程序还需要改变工作目录和根目录。

### 服务器程序后台化

- fork一个进程
- 将父进程退出（这里有一个疑问不会成为孤儿进程吗？）
- 对子进程设置权限掩码，创建会话，设置本进程为进程组的首领。
- 切换目录
- 关闭标准输入设备，标准输出设备和标准错误输出设备，开启一些文件描述符。