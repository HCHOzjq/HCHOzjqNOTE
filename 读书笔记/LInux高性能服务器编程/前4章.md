### 数据链路层

- 作用：实现了网卡接口的网络驱动程序

- ARP协议（Address Resolve Protocol，地址解析协议）用来将IP地址转换为物理地址
- RARP（Reverse Address Resolve Protocol，逆地址解析协议）通过网卡上的物理地址来查询IP地址，通常用在无盘工作站上（个人猜想是如路由器之类的）。

### 网络层

- 作用：实现数据报的选路和转发。
- IP协议（Internet Protocol因特网协议）：IP协议根据数据包的目的IP地址来决定如何投递它。
- ICMP协议（Internel Control Message Protocol因特网控制报文协议）：主要用于检测网络连接。差错报文来回应网络错误（不可达到和重定向），查询报文用来查询网络信息，如ping。循环冗余校验（CRC）。

### IP分片

当IP数据报长度超过帧的MTU时，它将被分片传输。

以太网的MTU是1500字节，因此它携带的IP数据报的数据部分最多是1480（IP头部占20字节）。

### IP模块工作流程

- IP模块接收到来自数据链路层的IP数据报时，它首先对该数据报的头部做CRC校验，确认无误之后就分析头部信息。

- 之后用IP协议其中的字段来判断要分用给哪个上层应用。若不是发给本机，就用转发子模块来处理该数据包。在这个过程中，会先先检测该系统是否支持转发，若否，IP模块丢弃数据报。
- 转发是要通过IP路过过程，其中核心结构是路由表。

### 路由机制

- 先查询路由表中与数据报的目标IP地址完全匹配的主机IP地址，若找不到，就查找路由表中的数据报的目标IP地址具有相同网络ID的网络IP地址。若找不到就将数据报发送到网关。

### 传输层

- 作用：为两台主机上的应用程序提供端到端通信。
- TCP（Transmission Control Protocol传输层控制协议）为应用层提供可靠的，面向连接的和基于流的服务。TCP支持超时重传，数据确认等方式。
- UDP（User Datagram Protocol用户数据报协议）：为应用层提供不可靠，无连接和基于数据报的服务。
- SCTP（Stream Control Transmission Protocol流控制传输协议）：为了在因特网上传输电话信号而设计的。

### TCP协议详解

特点：先建立连接，才能开始读写。全双工：双方数据读写可以通过一个连接进行。采用发送应答机制。

### TCP三次握手

- 客户端向服务端发送一个SYN请求报文（同步报文段），初始化ISN序号。
- 服务端向客户端发送一个SYN和ACK报文，表明已经收到请求。ACK中的序号是第一次握手的ISN序号+1。
- 客户端向服务端发送一个ACK请求表面，是第二次握手的ISN+1。

- 一次握手：服务端可能收不到SYN报文
- 二次握手：服务端可能受到SYN洪流，浪费幅度端资源
- 四次握手：1是三次握手已经满足稳定连接的要求了，所以没必要四次。而是为了让客户端先建立连接，我们握手次数需要是奇数。

### TCP四次挥手

- 客户端向服务端发送FIN数据报表示要断开连接
- 服务端向客户端发送FIN的确认表示受到客户端FIN请求
- 服务端可能还有数据没处理完，等处理完后发送FIN给客户端表明关闭连接，可以和第二次整合在一起
- 客户端发送FIN的确认给服务端，进入TIME_WAIT。等待2MSL（报文段之间的最短时间*2），等待服务端的确认信息，后才断开连接。

### 超时连接和超时重传

- 超时连接起始值是1s，以2倍数增长，最多是5次。
- 超时重传起始值是0.2s，以2倍数增长，最少3次，最多15次。

### 拥塞控制

- 简单说就是控制发送量大小到合适范围。

- 慢启动的理由：TCP刚开始发送数据时并不知道网络的实际情况，需要用一种试探的方式平滑增加CWND（拥塞窗口）大小。
- 拥塞窗口是发送方使用的流量控制，而通告窗口是接收方使用的流量控制。它等于min(RWND，SWND)。
- 慢启动是CWND按照初始值为1报文段，每收到一个ACK后，按指数型扩大的，当发送速率到达了互联网容量了，中间路由会丢弃分组，然后通知发送方它的窗口太大。从而使用拥塞避免阶段，该阶段使用拥塞避免算法使得CWND按线性方式增加，从而减缓其扩大。

### 代理

- 正向代理要求客户端自己设置代理服务器的地址。
- 反向代理则被设置在服务端。也就是说进入代理服务器后，请求转发的地址不需要用户提供，从而保证了该代理服务器是由内网设置的。

![image-20210227210548215](D:\桌面\推文\Linux高性能服务器编程\正向代理和反向代理.jpg)

### 应用层

- 处理应用程序的逻辑，在用户空间实现。
- ping等应用程序

![image-20210227000615479](D:\桌面\推文\Linux高性能服务器编程\1.jpg)

透明代理：只能设置在网关上，用户访问Internet的数据都必然通过网关。如果在网关上设置代理，则该代理对用户来说是透明的。透明代理可看作正向代理的一种特殊情况。

能提供软件的有：squid、varnish。

### ARP协议如何查找目标物理地址

首先由当前机器请求广播，广播信号中放着目标网络地址，目标收到请求后，回应一个ARP应答，其中包含自己的物理地址。

### DNS工作原理

作用：将域名转换为IP地址。

### Socket与TCP/IP协议簇的关系

- 将应用程序数据从用户缓冲区中复制到TCP/UDP内核发送缓冲区，以交付内核来发送数据，或者是从内核TCP/UDP接受缓冲区中复制数据到用户缓冲区，读取数据。

- 应用程序可以通过他们来修改内核中各处协议的头部信息或者其他数据结构。用来精细控制底层通信行为。

![image-20210227071600998](D:\桌面\推文\Linux高性能服务器编程\2.jpg)

### GET和POST

- GET向服务器请求资源，而不对服务器产生其他任何影响。（安全方法，不会对服务器进行修改）
- POST客户端向服务器提交数据的方法，这种方法会影响服务器。

### URI：

Uniform Resource Identifier，统一资源标识符

### URL：

Uniform Resource Location统一资源定位符

URI的最常见的形式是[统一资源定位符](https://link.jianshu.com?t=https://zh.wikipedia.org/wiki/统一资源定位符)（URL），经常指定为非正式的网址。更罕见的用法是[统一资源名称](https://link.jianshu.com?t=https://zh.wikipedia.org/wiki/统一资源名称)（URN），其目的是通过提供一种途径。用于在特定的命名空间资源的标识，以补充网址。

通俗地说，URL和URN是URI的子集，URI属于URL更高层次的抽象，一种字符串文本标准。

### HTTP应答：

100：服务器收到了客户端的请求行和头部信息，告诉了客户端继续发送数据部分

200：请求成功

301：资源被转移了，请求将被重定向

302：通知客户端资源能在其他地方找到，但需要用GET方法获得它

304：表示申请的资源没有被更新，和之前获得的相同

307：通知客户端资源能在其他地方找到，与302不同的是，客户端可以使用和原始请求相同的请求方法来访问目标资源。

400：通用客户请求错误

401：请求需要认证信息

403：访问服务器禁止

404：资源没找到

407：客户端需要先获得代理服务器的认证

500：通用服务器错误

503：暂时无法访问服务器