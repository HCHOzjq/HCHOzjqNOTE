题目意思就是给一些区间，求里面二进制是偶数个1还是奇数个，用带权并查集。

要注意`init()`会不会超。要注意是不是全都正确。给两种代码，一种是`map`，另外一种直接离散处理。

### map Hash

```C++
#include<iostream>
#include<cstdio>
#include<cstring>
#include<map>
#include<string>
using namespace std;

int fa[10004];
int val[10004];
void init(int n)
{
	for(int i=0;i<=n;i++){
		fa[i]=i;
		val[i]=0;
	}
}
int cnt;
map<int,int> mp;
int getnum(int x)
{
	if(mp.count(x))return mp[x];
	else return mp[x]=cnt++;
}

int get(int x)
{
	if(x==fa[x])return x;
	int t=fa[x];
	fa[x]=get(fa[x]);
	val[x]^=val[t];
	return fa[x];
}

int main()
{
	
	int m;
	int n;
	while(~scanf("%d%d",&n,&m))
	{
		mp.clear();
		cnt=1;
		init(10004);
		int ans=0;
		int flag=0;
		for(int i=1;i<=m;i++)
		{
			int a,b;string str;
			cin>>a>>b>>str;
			if(flag)continue;
			
			if(a>b)swap(a,b);
			a--;
			a=getnum(a),b=getnum(b);
			int w;
			if(str[0]=='e'){
				w=0;
			} else {
				w=1;
			}
			int x=get(a),y=get(b);
			if(x==y){
				if(val[a]^val[b]!=w){
					ans=i-1;
					flag=1;
				}
			}else {
				fa[y]=x;
				val[y]=val[a]^val[b]^w;
			}
		
	}
		if(flag!=0)
		printf("%d\n",ans);
		else printf("%d\n",m);
		}
}
```



### 离散化

```C++
#include<iostream>
#include<cstdio>
#include<cstring>
#include<map>
#include<string>
#include<algorithm>
using namespace std;

int fa[10004];
int val[10004];
int point[20005];
struct node
{
	int u,v,w;
}no[10005];
void init(int n)
{
	for(int i=0;i<=n;i++){
		fa[i]=i;
		val[i]=0;
	}
}
int cnt;

int get(int x)
{
	if(x==fa[x])return x;
	int t=fa[x];
	fa[x]=get(fa[x]);
	val[x]^=val[t];
	return fa[x];
}

int main()
{
	int m;
	int n;
	while(~scanf("%d%d",&n,&m))
	{
		cnt=1;
		init(10004);
		int ans=0;
		int flag=0;
		int z=0;
		for(int i=0;i<m;i++)
		{
			int a,b;string str;
			cin>>a>>b>>str;
			no[i].u=a;no[i].v=b;
			no[i].w=(str=="even"?0:1);
			if(a>b)swap(a,b);
			point[z++]=a-1;
			point[z++]=b;	
		}
		sort(point,point+z);
		z=unique(point,point+z)-point;
		for(int i=0;i<m;i++)
		{
			if(flag)break;
			int u=lower_bound(point,point+z,no[i].u-1)-point;
			int v=lower_bound(point,point+z,no[i].v)-point;
			int x=get(u),y=get(v);
			if(x==y){
				if(val[u]^val[v]!=no[i].w){
					ans=i;flag=1;
				}
			}else {
				fa[x]=y;
				val[x]=val[u]^val[v]^no[i].w;
			}
		}
		if(flag!=0)
		printf("%d\n",ans);
		else printf("%d\n",m);
		}
}
```

